# å¾®ä¿¡è½¬å­˜åŠ©æ‰‹ (Wx2save)

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![Python](https://img.shields.io/badge/python-3.9+-green.svg)
![Docker](https://img.shields.io/badge/docker-supported-blue.svg)

**å¾®ä¿¡è½¬å­˜åŠ©æ‰‹** æ˜¯ä¸€ä¸ªåŸºäº FastAPI æ„å»ºçš„é«˜æ€§èƒ½æ¶ˆæ¯æ¥æ”¶ã€è§£å¯†ã€å­˜å‚¨å’Œç®¡ç†ç³»ç»Ÿã€‚å®ƒèƒ½å¤Ÿå¯¹æ¥ä¼ä¸šå¾®ä¿¡ï¼ˆweworkï¼‰çš„ API å›è°ƒï¼Œå®æ—¶æ¥æ”¶æ¶ˆæ¯å¹¶æŒä¹…åŒ–å­˜å‚¨ï¼ŒåŒæ—¶æä¾›è¿™å°±å¥½äº†ä¸€ä¸ªç°ä»£åŒ–çš„ Web æ§åˆ¶å°ä¾›ç®¡ç†å‘˜æŸ¥çœ‹ã€æœç´¢å’Œç®¡ç†æ¶ˆæ¯ã€‚

---
## ä½¿ç”¨å‰åŠ¡å¿…å…ˆé˜…è¯»
    1.å¿…é¡»æœ‰ä¼ä¸šå¾®ä¿¡çš„ç®¡ç†å‘˜è´¦å·

    2.å¿…é¡»æœ‰å…¬ç½‘IPV4æˆ–è€…äº‘æœåŠ¡å™¨ï¼ˆå»ºè®®äº‘æœåŠ¡å™¨ï¼Œå®¶ç”¨IPV4åŠ¨æ€IPï¼Œéœ€ç»å¸¸æ›´æ–°ä¼ä¸šå¾®ä¿¡åº”ç”¨çš„å¯ä¿¡IPï¼‰ï¼Œæˆ–å…¶ä»–äººæä¾›çš„ä¼å¾®å…¬ç›Šè½¬å‘æœåŠ¡ã€‚

    3.å¿…é¡»æœ‰åŸŸåï¼Œå¹¶è§£æåˆ°å…¬ç½‘IPï¼Œåä»£æœ¬é¡¹ç›®ç«¯å£ï¼ˆé»˜è®¤8000ï¼‰

    4.ä¼šä¼ä¸šå¾®ä¿¡åº”ç”¨çš„å›è°ƒæ¥å£é…ç½®ã€‚

    5.æä¾›å‡ ä¸ªå¯è¡Œçš„æ–¹æ¡ˆã€‚
      A.å…¬ç½‘åŠ¨æ€IPV4+åŸŸå+åä»£ï¼ŒMPçš„æ’ä»¶æ¥æ›´æ–°ä¼ä¸šå¾®ä¿¡åº”ç”¨çš„å¯ä¿¡ipã€‚
      B.äº‘æœåŠ¡å™¨+åŸŸå+åä»£ï¼Œç›´æ¥éƒ¨ç½²åœ¨äº‘æœåŠ¡å™¨ä¸Šï¼Œæ–‡ä»¶å¯ä»¥ä¿å­˜åœ¨äº‘æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä¿å­˜åœ¨nasç«¯éƒ¨ç½²çš„S3å‚¨å­˜ã€‚
      C.äº‘æœåŠ¡å™¨+åŸŸå+åä»£ï¼Œé¡¹ç›®éƒ¨ç½²åœ¨nasç«¯ï¼Œé€šè¿‡äº‘æœåŠ¡å™¨è½¬å‘æ•°æ®åŒ…åˆ°ä¼ä¸šå¾®ä¿¡apiã€‚
      D.nasæœ¬åœ°æœ¬èº«å°±æœ‰å›ºå®šå…¬ç½‘ipv4ï¼ˆåœŸè±ªä¸“ç”¨ï¼‰ã€‚

## ğŸš€ ä¸»è¦åŠŸèƒ½

- **âš¡ é«˜æ€§èƒ½è§£å¯†**: ä½¿ç”¨ C++ ç¼–å†™çš„ `WXBizMsgCrypt` å®˜æ–¹åº“å°è£…ï¼Œç¡®ä¿é«˜å¹¶å‘ä¸‹çš„æ¶ˆæ¯è§£å¯†æ€§èƒ½ã€‚
- **ğŸ’¾ æ¶ˆæ¯æŒä¹…åŒ–**: è‡ªåŠ¨å°†æ¥æ”¶åˆ°çš„ XML æ¶ˆæ¯è§£æå¹¶å­˜å‚¨åˆ° SQLite æ•°æ®åº“ï¼ˆåç»­æ”¯æŒå¹³æ»‘è¿ç§»åˆ° MySQL/PostgreSQLï¼‰ã€‚
- **ğŸ“Š Web ç®¡ç†æ§åˆ¶å°**:
  - **ä»ªè¡¨ç›˜**: å®æ—¶æŸ¥çœ‹æ¶ˆæ¯ç»Ÿè®¡å’Œæœ€æ–°æ¶ˆæ¯ã€‚
  - **æ¶ˆæ¯æ£€ç´¢**: æ ¹æ®æ—¶é—´ã€å‘é€è€…ã€æ¶ˆæ¯ç±»å‹è¿›è¡Œå…¨æ–‡æ£€ç´¢ã€‚
  - **å¤šç±»å‹æ”¯æŒ**: å®Œç¾å±•ç¤ºæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ã€é“¾æ¥ã€å¤–éƒ¨è”ç³»äººç­‰å¤šç§æ¶ˆæ¯ç±»å‹ã€‚
- **ğŸ›¡ï¸ å®‰å…¨å¯é **:
  - å®Œæ•´çš„ç™»å½•è®¤è¯æœºåˆ¶ã€‚
  - è‡ªåŠ¨ CSRF ä¿æŠ¤å’Œå®‰å…¨æ ‡å¤´ã€‚
  - æ•æ„Ÿé…ç½®åŠ å¯†å­˜å‚¨ã€‚
- **ğŸ“¦ æ‰¹é‡æ“ä½œ**: æ”¯æŒæ¶ˆæ¯çš„æ‰¹é‡åˆ é™¤å’Œæ‰¹é‡æ‰“åŒ…ä¸‹è½½ï¼ˆZIP æ ¼å¼ï¼‰ã€‚
- **ğŸ³ Docker æ”¯æŒ**: æä¾›ä¸€é”®éƒ¨ç½²çš„ Docker é•œåƒå’Œ `docker-compose` é…ç½®ã€‚
- **ğŸ’¾ å¯¹è±¡å­˜å‚¨**: æ”¯æŒå°†æ–‡ä»¶å­˜å‚¨åˆ°S3å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ MinIOã€é˜¿é‡Œäº‘OSSç­‰ï¼‰ï¼Œå®ç°æ–‡ä»¶å‚¨å­˜å’Œé¡¹ç›®åˆ†ç¦»ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **åç«¯**: [FastAPI](https://fastapi.tiangolo.com/) (Python 3.9+)
- **æ•°æ®åº“**: SQLAlchemy (ORM) + SQLite (Default)
- **æ¨¡æ¿å¼•æ“**: Jinja2
- **å‰ç«¯**: Bootstrap 5 + Vanilla JS
- **éƒ¨ç½²**: Docker + Docker Compose

## ğŸ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šDocker éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. **é…ç½®ç¯å¢ƒ**:
   - é¦–æ¬¡è¿è¡Œå»ºè®®å…ˆåˆ›å»ºæŒä¹…åŒ–ç›®å½•ï¼š
   ```bash
   mkdir -p data
   mkdir -p media_files
   ```
   åç»­dockerä¼šåœ¨dataç›®å½•ä¸‹åˆ›å»ºconfig.yamlé…ç½®æ–‡ä»¶ï¼Œå¹¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ã€‚
   - ä¹Ÿå¯ä»¥å…ˆæ‰‹åŠ¨åˆ›å»ºconfig.yamlæ–‡ä»¶ï¼Œå¹¶å¡«å¥½ä¼ä¸šå¾®ä¿¡çš„é…ç½®ä¿¡æ¯ã€‚

  - æ¨èdocker compose éƒ¨ç½²:
  ```bash
  version: '3.8'
  services:
    wx2save:
      image: jonysun/wx2save:latest
      container_name: wx2save
      restart: unless-stopped
      ports:
        - "8000:8000"
      volumes:
        - ./data:/app/data
        - ./logs:/app/app/logs
        - ./media_files:/app/media_files
      environment:
        - TZ=Asia/Shanghai
        - LOG_DIR=/app/app/logs
        - DATABASE_URL=sqlite:////app/wecom_messages.db
      healthcheck:
        test: [ "CMD", "curl", "-f", "http://localhost:8000/login" ]
        interval: 30s
        timeout: 10s
        retries: 3
      logging:
        driver: "json-file"
        options:
          max-size: "10m"
          max-file: "3"
  ```

2. **å¯åŠ¨æœåŠ¡**:
   ```bash
   docker-compose up -d
   ```

3. **è®¿é—®æ§åˆ¶å°**:
   æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8000`ã€‚
   *é»˜è®¤ç®¡ç†å‘˜è´¦å·ä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¥å¿—ä¸­ç”Ÿæˆï¼Œè¯·æ³¨æ„æŸ¥çœ‹ã€‚*
   - é¦–æ¬¡ç™»å½•åï¼Œä¼šæç¤ºå¼ºåˆ¶ä¿®æ”¹é»˜è®¤å¯†ç ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰ã€‚

4. **é…ç½®ä¼ä¸šå¾®ä¿¡**:
   - ç™»å½•åï¼Œè¿›å…¥â€œç³»ç»Ÿè®¾ç½®â€é¡µé¢ï¼Œå¡«å…¥ä¼ä¸šå¾®ä¿¡çš„é…ç½®ä¿¡æ¯å¹¶ä¿å­˜ã€‚

5.  **æ¥æ”¶æ¶ˆæ¯**:
    - æ£€æŸ¥é¡¹ç›®ä¸­çš„ä¼ä¸šå¾®ä¿¡ç›¸å…³é…ç½®ä¸ä¼ä¸šå¾®ä¿¡åå°é…ç½®ä¸€è‡´ï¼Œä¸”ä¼ä¸šå¾®ä¿¡åå°å›è°ƒæˆåŠŸåï¼Œå°è¯•å‘é€æ¶ˆæ¯åˆ°å®¢æœï¼ŒæˆåŠŸåå³åœ¨webç•Œé¢çœ‹åˆ°æ¶ˆæ¯ã€‚


### æ–¹å¼äºŒï¼šæœ¬åœ°è¿è¡Œ

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. åˆå§‹åŒ–é…ç½®
python init_config.py

# 3. å¯åŠ¨æœåŠ¡
python main.py
```

æ›´è¯¦ç»†çš„å®‰è£…å’Œé…ç½®æŒ‡å—ï¼Œè¯·å‚é˜… [å®‰è£…é…ç½®æŒ‡å— (INSTALL.md)](./INSTALL.md)ã€‚

## ğŸ“ é…ç½®è¯´æ˜

æ ¸å¿ƒé…ç½®æ–‡ä»¶ä½äº `data/config.yaml`ã€‚ä½ éœ€è¦å¡«å…¥ä¼ä¸šå¾®ä¿¡åå°æä¾›çš„ä»¥ä¸‹ä¿¡æ¯ï¼š

```yaml
wecom:
  corp_id: "ww..."          # ä¼ä¸šIDï¼Œåœ¨ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°->æˆ‘çš„ä¼ä¸š->ä¼ä¸šä¿¡æ¯ä¸­æŸ¥çœ‹
  corp_secret: "..."        # åº”ç”¨Secretï¼Œåœ¨ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°->åº”ç”¨ä¸æœåŠ¡->åº”ç”¨ç®¡ç†->è‡ªå»ºåº”ç”¨->ç‚¹å‡»åº”ç”¨->ç®¡ç†->Secretä¸­æŸ¥çœ‹
  token: "..."              # å›è°ƒTokenï¼Œåœ¨ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°->åº”ç”¨ä¸æœåŠ¡->åº”ç”¨ç®¡ç†->è‡ªå»ºåº”ç”¨->ç‚¹å‡»åº”ç”¨->ç®¡ç†->æ¥æ”¶æ¶ˆæ¯->è®¾ç½®apiæ¥æ”¶ä¸­æŸ¥çœ‹
  encoding_aes_key: "..."   # å›è°ƒAESKeyï¼Œåœ¨ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°->åº”ç”¨ä¸æœåŠ¡->åº”ç”¨ç®¡ç†->è‡ªå»ºåº”ç”¨->ç‚¹å‡»åº”ç”¨->ç®¡ç†->æ¥æ”¶æ¶ˆæ¯->è®¾ç½®apiæ¥æ”¶æŸ¥çœ‹
```

ä¼ä¸šå¾®ä¿¡åå°è®¾ç½®æ­¥éª¤ï¼š

1ã€åˆ›å»ºä¼ä¸šå¾®ä¿¡åº”ç”¨ï¼Œè¿›å…¥æ¥æ”¶æ¶ˆæ¯->è®¾ç½®apiæ¥æ”¶

2ã€éšæœºç”Ÿæˆæˆ–è‡ªå·±å¡«å†™tokenã€encoding_aes_key

3ã€æœ¬é¡¹ç›®config.yamlæˆ–è€…å‰ç«¯é¡µé¢å¡«å…¥ä¸Šè¿°tokenã€encoding_aes_keyã€corp_idã€corp_secretå¹¶ä¿å­˜ç”Ÿæ•ˆã€‚

4ã€ä¼ä¸šå¾®ä¿¡åº”ç”¨->é…ç½®å›è°ƒæ¥å£,å¡«å…¥ä½ çš„åŸŸå+ç«¯å£+å›è°ƒæ¥å£è·¯å¾„ï¼ˆé»˜è®¤ï¼šhttp://ä½ çš„åŸŸå:ç«¯å£/wecom/callbackï¼‰

5ã€ç‚¹å‡»ä¿å­˜åï¼Œä¼ä¸šå¾®ä¿¡ä¼šå‘ä½ çš„å›è°ƒæ¥å£å‘é€ä¸€ä¸ªGETè¯·æ±‚ï¼ŒéªŒè¯å›è°ƒæ¥å£æ˜¯å¦å¯ç”¨ï¼Œå¦‚æœéªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥å›è°ƒæ¥å£æ˜¯å¦å¯ç”¨ï¼Œæ˜¯å¦å¯ä»¥è¢«å…¬ç½‘è®¿é—®ï¼Œé˜²ç«å¢™æ˜¯å¦æ”¾è¡Œè¯¥ç«¯å£ã€‚

6ã€ä¼ä¸šå¾®ä¿¡åå°->åº”ç”¨ç®¡ç†->å¾®ä¿¡å®¢æœ->å®¢æœè´¦å·->åˆ›å»ºå®¢æœè´¦å·ï¼Œç„¶ååœ¨å¾®ä¿¡å®¢æœæœ€ä¸‹é¢ï¼Œé€šè¿‡APIç®¡ç†ä¼šè¯æ¶ˆæ¯-> ç»‘å®šå‰é¢åˆ›å»ºçš„åº”ç”¨ã€‚

7ã€ä¼ä¸šå¾®ä¿¡åå°->åº”ç”¨ç®¡ç†->å¾®ä¿¡å®¢æœ->å®¢æœè´¦å·->åˆšåˆšåˆ›å»ºçš„å®¢æœè´¦å·-> é‡Œçš„è¿æ¥ï¼Œç”¨å¸¸ç”¨å¾®ä¿¡å·ç‚¹å¼€ï¼Œå°±æ˜¯æ·»åŠ äº†å®¢æœï¼Œç„¶åå°±å¯ä»¥åœ¨å¸¸ç”¨å¾®ä¿¡å·é‡Œç»™å®¢æœå‘æ¶ˆæ¯äº†ã€‚æœ¬é¡¹ç›®åå°å³å¯è‡ªåŠ¨ä¿å­˜æ¶ˆæ¯å†…å®¹ã€æ–‡ä»¶ã€‚

![ScreenShot 2026 02 10 210852 350](https://origin.picgo.net/2026/02/10/ScreenShot_2026-02-10_210852_35088a40a54f46ea5b1.png)


## ğŸ“¸ è¿è¡Œæˆªå›¾

![ScreenShot 2026 02 10 113232 489](https://origin.picgo.net/2026/02/10/ScreenShot_2026-02-10_113232_48940e7255cb4b50918.png)
![ScreenShot 2026 02 10 113327 034](https://origin.picgo.net/2026/02/10/ScreenShot_2026-02-10_113327_0345c5f9b5ac8c44200.png)


## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

Copyright (c) 2026 Wx2save
